# 第 3 章　仮想化とルータ

## 目標

最終目標：自分の web ページを見れるようにセッティングする。  
前回は、Ubuntu に web サーバをインストールすれば、web サービスを提供することができるということがわかりました。  
今回はさらに目標を明確化し、それに対応する知識を学びましょう。

## 用語

|            |                                                                    |
| ---------: | :----------------------------------------------------------------- |
| ～を立てる | コンピュータにプログラムをインストールし、各種設定を完了させること |

## 目標の再定義

質問です。 サービスを提供する範囲はどうしますか。  
もっとかみ砕くと、ある PC で web サーバを立てたとして、別の機器（スマホや web サーバを立ててない別の PC）で web ページを見たくないですか？  
おそらく yes でしょう。このドキュメントも yes の人向けに書いています。  
ちなみに no の人はどのような人かといいますと、web サーバを立てた PC でブラウザを開き、わざわざ web からファイルにアクセスする人です。  
常駐している意味よ、自分でファイル開けや！  
一応言っておくと、上の方法で web サーバにアクセスする方法は localhost 接続といって、サーバ本体が動いているかを確認するときに使います。  
localhost は簡単に言えば自問自答で、アクセスする際に不具合が起きている可能性を排除できるのです。

## 接続範囲

自分の OS 以外からアクセスがくることを「外部接続が試みられた」といいます。  
OS は web サーバへの外部接続が試みられると、「これは web サーバさん宛（アプリ単位）の通信だな」と判断することができます。  
（正確には 8，9 章で）  
OS では、その外部接続を通過するか拒否するか設定できます。  
外部接続の可否は、OS 目線、自分か自分以外かで決めます。  
外部接続を拒否すると僕のスマホで見えなくなってしまいます。  
僕のスマホだけアクセスを通過させる、という設定は少し手がかかります。  
じゃあ外部接続を通過させるか。  
しかし、それは俗に言うインターネットに公開された状態のことです。  
僕のスマホ以外の誰でも接続できてしまいますから。  
単純に、インターネットに公開するとなるとセキュリティ上リスクがはらみます。  
学習用コンピュータを公開してよいなら別良いのですが、多くの人は嫌なはずです。  
同じルータ内（家の中）なら公開状態にでき、それより外からの接続は遮断する。  
今から説明する仮想化なら、可能です。  
（インターネットに公開する方法も記載）

## 仮想化

前回、OS もアプリケーションもソフトウェアであることを学びました。  
ではソフトウェアを動かすソフトウェアは作れるでしょうか。 可能です。  
それを実現することを仮想化といいます。  
ソフトウェアを動かすソフトウェアを仮想ソフト、仮想ソフトが入っているコンピュータをホスト、仮想ソフト上で動いているソフトウェアをゲスト、といいます。  
仮想ソフトが予めホストに、ゲストが必要とする機能を提供しておき、ゲストが本来ハードウェアに対してする要求を、仮想ソフトが代わりにホストへ要求する、という仕組みです。  
仮想化にも種類があり、ホスト型・ハイパバイザ型・コンテナ型があります。  
詳細は各自で調べてもらうとして、今回はホスト型を使います。  
ちなみにハイパバイザ型は、サーバといわれてぱっと思い浮かべるような物に搭載されており、コンテナ型は、Docker という OSS が有名です。

## クラウド

実習のための知識には必要ないのですが、仮想化技術が使われたものにクラウドがあります。  
クラウドと聞くと、OneDrive や Google Drive、iCloud などのクラウドストレージが思いつくでしょうか。  
クラウドは、企業が持っているコンピュータのパワーを、利用者にネットワーク越しで提供するサービスです。  
企業がコンピュータのどこまでを提供するかで、IaaS, PaaS, SaaS と種類があります。  
料金体系が違うだけで、IaaS と VPS、SaaS とレンタルサーバは同じものが提供されます。  
結局、仮想化はコンピュータの物理構成によらず、柔軟に分割・統合ができる技術のことで、いろんな場所で使われています。  
クラウド上にサービスを構築する場面もあるかもしれないので、さわりだけでも知っておきましょう。

## ルータ

結局、なぜ仮想化で、同じルータ内（家の中）なら公開、それより外からの接続は遮断する、いうことができるか説明できていませんね。  
今回、構築にはホスト型の仮想ソフトである VirtualBox を使います。  
VirtualBox 上では複数の OS を動かすことができます。  
OS はデータ通信を行いますから、VirtualBox には複数個所からのデータ通信を  
混在しないように上手く捌く機能が必要です。  
単に通信を管理することをルーティングといい、それをする機械をルータといいます。  
Wifi ルータは家のどこかに 1 台は置いてあるのではないでしょうか。  
仮想ソフト内（仮想環境）でのルータ機能を仮想ルータといいます。  
仮想環境上の OS（ゲスト OS）ができる通信の設定は仮想ルータに対するもので、家に置いてあるルータ（home ルータ）に対する設定はできません。  
home ルータに対する設定はホストの OS（ホスト OS）が行います。

ホスト OS では同じ home ルータからの接続（ローカルエリア接続）のみ、ゲスト OS ではすべての接続を、通過させる設定にする。  
外部接続の場合、ホスト OS は home ルータの通信を拒否します。  
home ルータ内のスマホからの接続の場合、ローカルエリア接続なので、ホスト OS は home ルータの通信を通過させます。  
ゲスト OS ではすべての接続を通過させるので、スマホから web サーバに通信がたどり着きました。

## 最終的に

VirtualBox 上の Ubuntu に web サーバをインストールすれば、web ページをスマホから閲覧できることがわかりました。  
次回は PC に VirtualBox を入れてみましょう。

## 確認問題

1. 今回作りたいネットワークを描け。
2. 仮想化ソフトは VirtualBox 以外にどのようなものがあるか調べよ。
3. IaaS, PaaS, SaaS の違いは何か調べよ。 また、AWS はどれに当たるか。

## 参考資料

【IT 用語辞典】  
[仮想化](https://e-words.jp/w/%E4%BB%AE%E6%83%B3%E5%8C%96.html "仮想化とは")  
[クラウドサービス](https://e-words.jp/w/%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9.html "クラウドサービスとは")  
[ルータ](https://e-words.jp/w/%E3%83%AB%E3%83%BC%E3%82%BF.html "ルータとは")

【wikipedia】  
[クラウドコンピューティング](https://ja.wikipedia.org/wiki/%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0 "クラウドコンピューティング")

【その他】  
[仮想マシン](https://www.designet.co.jp/ossinfo/selection/virtual-infrastructure.html "サーバ仮想化とは")を簡単に理解する。  
[クラウド](https://www.geekly.co.jp/column/cat-technology/1903_079/ "クラウドと仮想化の違いとは？")を簡単に理解する。  
[ルーティング](https://www.netvisionacademy.com/column/5340/ "ルーティングとは")を簡単に理解する。
