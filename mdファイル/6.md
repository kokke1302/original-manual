# アプリを入れてみよう！

## 目標

最終目標：自分の web ページを見れるようにセッティングする。  
前回は Ubuntu を動かせるようにした。
今回は Ubuntu に慣れてもらう。

## 用語

|     |     |
| --: | :-- |

## 軽く触る

今回インストールした Ubuntu Desktop は「これからサーバ立てるんだよね」と身構える必要はない。  
サーバは店員さんのようなもので、サービスをする時と受ける時がある。  
サービスをする時はサーバだが、Windows のように普段使いできるようにもなっている。

左上の音量マークら辺を押して、有線になっていると思う。  
これは wifi 接続しているノート PC でもそう表示される。  
これは前回設定したネットワークブリッジの影響だ。  
VirtualBox には仮想マシンの外に仮想的なルータが設置されている。  
ネットワークブリッジという設定だと、家に置いてある wifi のルータ（ホームルータ）は VirtualBox の仮想ルータを子機として接続し、仮想マシンは仮想ルータに接続している状況になる。  
いや、結局どんな状況かよく分からないって？  
ちゃんとネットワークのイメージができてる？

ホームルータは仮想ルータを「ネットワーク機器が（ホストマシンとは別で）1 つ増えたなー」認識する。  
仮想マシンからネットワークの設定をしようとすると、仮想ルータしかいじれない。

おそらく左下にある Ubuntu マークを押すと Windows ボタンを押したときのように、アプリの一覧が出てくる。  
これらは gui があるアプリ達である。

## VScode

### どんなアプリ？

VScode は Visual Studio Code というマイクロソフトが開発しているコードエディタの略称だ。  
プログラムを書く時に使うメモ帳のようなアプリである。  
なぜこれをインストールするか。

前提として、web ページをどのように表示するかを示したファイルを html ファイルという。  
その中には html という言語で内容が書かれている。  
そして、html を書く際はコードエディタを使うと便利なことが多い。

コードエディタの share 率は VScode が半数を占める。  
別に nano エディタや Vim、emacs のようなテキストエディタでもいい。  
~~しかし時代遅れ感は否めない。~~  
別に JetBrains 系や Atom のような最新のコードエディタでもよい。  
~~しかしそれらは VScode が基になっている。~~

まあ、コードを書くときはまず VScode から使い始めるのがよいだろう。

### インストール

アプリをインストールする方法の１つ目は、Google Play ストアのような場所からインストールするやり方だ。  
アプリセンターがそのストアに該当する。  
Ubuntu マーク/アプリセンター/検索バー にて code と入力する。  
無限「∞」をイメージしたアイコンらしいのだが、僕にはそう見えない。  
青色の魚みたいなマークを選択しインストールする。  
アプリ一覧に追加されたはずだ。  
あとは windows 版と同じように使える。  
各種設定のやり方は調べれば山のように出てくるので割愛する。

## tree コマンド

### コマンド

「OS の核であるカーネルに指示したり、それらからの出力（返事）を表示したりする機能をシェルという。」と第 2 章で教えた。  
Ubuntu には bash、Mac は zsh というシェルが使われている。  
しかしシェルは OS レベルの"機能"で、"アプリケーション"ではない。  
シェルを扱えるようにしたアプリケーションをターミナルという。  
アプリ一覧にて『端末』を押すと黒い画面が開く。  
『端末』は『ターミナル』を日本語訳するとなってしまうだけで、普通、この黒い画面をターミナルいう。  
Mac ではそのままターミナルというアプリ名である。

結局、ターミナルに shell スクリプトを入れると、OS に指示できる。  
shell スクリプトを C 言語で使いやすくしたのが、Linux コマンドだ。  
例えばこんなやつだ。

```bash
mv sky.jpg Pictures/sky.jpg
```

コマンドが日本語で命令と訳されるように、Linux コマンドは英語の命令形  
「動詞（＋目的語（＋目的語））」の語順で書いていく。  
Linux コマンドでよく使うものは[このサイト](https://qiita.com/savaniased/items/d2c5c699188a0f1623ef)に載っている。  
だが、実際にはよく使うものと使わないものがあるので、やりたい事やコマンド名で都度調べて覚えればよい。  
リンク先にコマンドとその説明の他に、オプションという言葉がある。  
オプションというのは助動詞みたいなもので、簡単に言えば命令に対して詳細を追加できる。  
あ、助動詞といってもオプションは複数個あってもいいよ。

ターミナルでは、アプリに対しても命令できる。  
その時は、

```
アプリ名 動詞 （＋目的語（＋目的語））
```

のような形になる。  
アプリごとにできる命令が違うが、だいたい

```
アプリ名 -h
アプリ名 --help
アプリ名 help
```

のどれかで使い方を調べれる。  
まあ、アプリのホームページにドキュメントとしてまとめてあるはずなので、それを読むのが普通。

### ファイルシステム 1

ファイルシステムはハードウェア上のデータを整理・管理する OS の"機能"だ。  
ここは奥が深くて、どうやって管理してるかとか、FAT32 や NTFS とか、話し出せばキリがない。  
重要なのはファイルシステムが、

1. データをファイルとして見やすくしていること
2. 階層構造で管理していること

だ。  
ファイル・フォルダの管理をしたことがあるなら問題ない。  
写真は Picture ディレクトリの下層にあるし、Picture は写真の親ディレクトリだ。

ターミナルでは window のような作業の単位がないから、今開いているディレクトリ内で色々作業する。  
今居る（開いている）ディレクトリをカレントディレクトリという。  
このコマンドを打つとカレントディレクトリがわかる。

```
pwd
```

（Present Working Directory: 現在作業しているディレクトリ）  
ls コマンドはカレントディレクトリにある、ディレクトリやファイルの一覧を表示できる。

```
ls
```

（list）  
下の mkdir コマンドを打つと、カレントディレクトリに hoge という名前のディレクトリが作成される。

```
mkdir hoge
```

（make directory）
hoge（ほげ）はメタ構文変数といって例示のために用いられる特に意味のない名前。  
つまり何でもいいという意味で、適当な名前を付ければよい。  
foo（ふー）や bar（ばー）も同様にメタ構文変数で、サンプルプログラムにたまに出てくる。

```
ls
```

作ったディレクトリが一覧に増えているだろう。  
カレントディレクトリを移動しよう。

```
cd hoge
```

（change directory）  
pwd で hoge の下に移動したことがわかるはずだ。  
適当に VScode で txt ファイルを作る。

```
code foo.txt
```

「qwerty」とか適当に書いて保存しておこう。  
ターミナルに戻って、ls コマンドを打ち、foo.txt が増えていればよい。  
『ファイル』アプリで視覚的に理解することも可能だ。  
上のディレクトリを指定するには、『..』を使う。

```
cd ..
```

ちなみに、『~』でホームディレクトリ、『./』でカレントディレクトリ、『A/』でディレクトリ A の子ディレクトリを指定できる。  
上記 mkdir hoge は mkdir ./hoge とも書けるということだ。

### インストール

tree コマンドはディレクトリの階層構造をターミナル上で見やすくするコマンドだ。  
新しいコマンドも、アプリ同様インストールをすると使えるようになる。  
アプリをインストールする方法の 2 つ目として、ターミナルからインストールするやり方がある。  
ターミナルにて、下の 2 行を打つだけだ。

```
sudo apt update
sudo apt install アプリ名
```

まあ、知らないコマンドを打つのはためらってほしい。  
コマンドの意味を理解しよう。  
2 回目だが、アプリに対する Linux コマンドの基本形は下の語順である。

```
アプリ名 動詞 （＋目的語（＋目的語））
```

apt はアプリ名に当たる。  
Advanced Packaging Tool というソフトウェアで、パッケージ管理システムである。  
詳しくは、おまけパートで説明するが、gui のない Google Play ストアのようなものだ。  
VScode を入れた時に使ったアプリセンターも同じくパッケージ管理システムである。  
update や install は動詞だ。

```
apt -h
```

update は利用可能パッケージの一覧を更新、install はパッケージをインストールする命令とわかる。  
apt は他に upgrade, remove, autoremove を使うことがあるだろう。  
install は他動詞なので何をインストールするか書く必要があり、後ろにインストールしたいアプリ名を書く。

sudo はコンピュータから見た絶対命令だ。  
本来なら「ユーザー管理」と一緒に説明するものだが、一人で操作している前提で書いているので深くは話さない。  
アプリを入れるためには高い権限が必要なので、sudo で高い権限を持っていることを知らせているイメージだ。

では tree コマンドを入れてみよう。

```
tree
sudo apt update
sudo apt install tree
tree
```

1 回目の tree では「そんなコマンド知らん」と帰ってきたが、2 回目の tree ではコマンドが実行できたはずだ。  
hoge の下に a.txt があることが、hoge に移動しなくてもわかるようになった。

```
rm -r hoge
```

（remove：消去）  
（-r A：再帰的に：A とその下のファイル・ディレクトリを指定）  
上のコマンドで、今まで作ったディレクトリやファイルを消去した。

ふう、ここまで来れたら web サーバのインストールもチョチョイのチョイだ。  
今回導入する Apache はアプリケーションに過ぎないのだから。

## おまけ パッケージ管理システム

Linux では、アプリやプログラムはパッケージという単位でまとまっている。  
Android なら.apk、Debian 系なら.deb のように。  
パッケージを個々にインストールすると、いろんな不都合が生じる。  
それを解決するのがパッケージ管理システムだ。

パッケージ管理システムは大きく 3 つのことをしている。

1. 依存関係の解消
2. 更新の確認
3. パッケージ本体の保存

パッケージはいろんなパッケージを組み合わせて作られている。  
パッケージ A もパッケージ B も参照元 C を使って作られているとする。  
パッケージ A, B を個別にインストールした場合、C は 2 回インストールされる。  
しかし、2 回も同じものをインストールしたくない。  
故に「A, B は C に依存している」という関係を示し、余分なインストールを回避させる。  
A は C のバージョン 3.1 や 3.2 で動作できるが、B は 3.1 でしか動作できない、という状況もうまく対処してくれる。  
パッケージ管理システムは、上記 2 つの要素とパッケージ本体をまとめたものを、配布サーバで管理・配布する。

apt の場合 apt リポジトリで確認できる。  
（アプリでなくてもパッケージであればパッケージ管理システムは有用だ。Python の pip、Node.js の npm は、それぞれ PyPI、npm レジストリで確認できる。）  
日本の apt リポジトリは[Ubuntu Japan Team](https://www.ubuntulinux.jp/ubuntu/mirrors)から適当なサーバにと飛べばある。  
Linux/packages/ubuntu/archive/pool/universe/t に tree があることが確認できる。  
PC 内の apt は更新をするよう命令すると、/etc/apt/sources.list や/etc/apt/sources.list.d/ を参照し、この apt リポジトリに更新を確認しに行く。  
さあ、問題はここにインストールしたいアプリが載ってないときだ。

apt や snap（アプリセンター）に載っていないアプリのインストール方法を調べていると、やり方が複数ある時がある。  
アプリを入れる方法が、調べるサイトによって違うのだ。  
最初は困惑するが、[このサイト](https://zenn.dev/ikkik/articles/ffa45ed1fe5a1a)を理解できれば疑問は解決できると思う。

アプリをインストールする際、そのアプリの公式ホームページを見ないわけない。  
そこに載っているインストール方法は大きく 2 パターンあるだろう。

1. このコマンド打て
2. deb ファイルをダウンロードさせられる

1 つ目のパターンは、このコマンド打てと書かれている場合だ。  
firefox 系ブラウザである floop はこの方式だった。  
curl または wget, echo のような知らないコマンドが書いてあるだろう。  
知らないコマンドは無闇に打つべきではない。  
全体で何をやっているかというと、「更新時にここも一緒に見てこい」という情報を/etc/apt/sources.list.d/の下に手動で書いている。  
そうすれば、apt update も一緒に行ってくれるし、アンインストールも apt コマンドでできる。  
「見てこい」という命令は、サーバに対して通信を行っていることと同義だ。  
しかし、何もしないとコンピュータは素の情報で通信するだろう。  
つまり、誰がどこに何を要求しているのか筒抜けだし、改変だってやろうとすればできてしまう。  
そうなると、アップデートなどの通信中に、内容を改変してウイルスを掴ますことができてしまう。  
故に、デジタル署名で内容を秘匿化する必要が生じる。  
暗号化の方式は各自で調べてもらうとして、公開暗号鍵を取得するためのコマンドが curl や wget なのだ。  
他のコマンドは Linux コマンドリファレンスに載っている。と思う。

2 つ目のパターンは deb ファイルを渡されるときだ。  
Chromium 系ブラウザである vivaldi はこの方式だった。（snap 版だと正常に動かなかった。）  
これをどうすべきかというと、ダブルクリックでインストールする。  
または、

```
apt install ~.deb
```

とファイルが置いてある場所で打てばいい。（上手く行かなかったら gpkg コマンド）  
1.で手動でやっていたことが自動で行われる。  
apt update も一緒に行ってくれるし、アンインストールも apt コマンドでできる。

ここまで来れば Linux を普段使いできる程度にはなっていると思う。  
おめでとう。

[シェルとターミナル](https://zenn.dev/k_log24/articles/582af625164d41)  
[Linux コマンド](http://www.redout.net/data/command.html)  
[ほんとは怖くない-黒い画面入門](https://fjord.jp/kuroigamen.html)  
[ファイルシステムの構造](https://www.ibm.com/docs/ja/aix/7.1?topic=tree-file-system-structure)  
[ファイルシステム](https://e-words.jp/w/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0.html)  
[パスの表現](https://hwb.ecc.u-tokyo.ac.jp/hwb2023/literacy/filesystem/tree/)  
[パッケージ管理システムの仕組み](https://zenn.dev/ikkik/articles/ffa45ed1fe5a1a)
